# Konva Canvas æ¸²æŸ“å™¨

åŸºäº Vue 3 + TypeScript + Konva.js çš„ç”»å¸ƒæ¸²æŸ“å™¨é¡¹ç›®ã€‚

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **Vue 3** - æ¸è¿›å¼ JavaScript æ¡†æ¶
- **TypeScript** - JavaScript çš„è¶…é›†ï¼Œæä¾›ç±»å‹å®‰å…¨
- **Vite** - ä¸‹ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·
- **Konva.js** - 2D Canvas åº“
- **Tailwind CSS** - å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### å¼€å‘æ¨¡å¼

```bash
pnpm dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm build
```

### é¢„è§ˆç”Ÿäº§æ„å»º

```bash
pnpm preview
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ Render/                  # æ¸²æŸ“å™¨æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ RenderCore.ts   # Stageã€Layers ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ RenderEvents.ts # äº‹ä»¶ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ RenderUtils.ts  # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ RenderSettings.ts # è®¾ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts        # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ handlers/           # äº‹ä»¶å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ BaseHandler.ts  # å¤„ç†å™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ DragHandlers.ts # æ‹–æ‹½å¤„ç†
â”‚   â”‚   â”œâ”€â”€ ZoomHandlers.ts # ç¼©æ”¾å¤„ç†
â”‚   â”‚   â”œâ”€â”€ SelectionHandlers.ts # é€‰æ‹©å¤„ç†
â”‚   â”‚   â””â”€â”€ ...             # å…¶ä»–å¤„ç†å™¨
â”‚   â”œâ”€â”€ tools/              # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ BaseTool.ts     # å·¥å…·åŸºç±»
â”‚   â”‚   â”œâ”€â”€ AssetTool.ts    # ç´ æå·¥å…·
â”‚   â”‚   â”œâ”€â”€ SelectionTool.ts # é€‰æ‹©å·¥å…·
â”‚   â”‚   â”œâ”€â”€ CopyTool.ts     # å¤åˆ¶å·¥å…·
â”‚   â”‚   â””â”€â”€ AttractTool.ts  # ç£è´´å·¥å…·
â”‚   â”œâ”€â”€ draws/              # ç»˜åˆ¶ç±»
â”‚   â”‚   â”œâ”€â”€ BaseDraw.ts     # ç»˜åˆ¶åŸºç±»
â”‚   â”‚   â”œâ”€â”€ BgDraw.ts       # èƒŒæ™¯ç½‘æ ¼
â”‚   â”‚   â”œâ”€â”€ RulerDraw.ts    # æ ‡å°º
â”‚   â”‚   â”œâ”€â”€ ScaleInfoDraw.ts # ç¼©æ”¾ä¿¡æ¯
â”‚   â”‚   â””â”€â”€ ...             # å…¶ä»–ç»˜åˆ¶ç±»
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ aStar.ts        # A* ç®—æ³•
â”‚   â”œâ”€â”€ types.ts            # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts            # ä¸»å…¥å£
â””â”€â”€ App.vue                 # åº”ç”¨å…¥å£
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### æ¸²æŸ“å™¨ (Render)

ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ Canvas æ¸²æŸ“å™¨ï¼Œæ”¯æŒï¼š

- âœ… **å¤šå›¾å±‚ç®¡ç†** - floorï¼ˆåº•å±‚ï¼‰ã€mainï¼ˆä¸»å±‚ï¼‰ã€coverï¼ˆè¦†ç›–å±‚ï¼‰
- âœ… **èƒŒæ™¯ç½‘æ ¼** - å¯é…ç½®çš„ç½‘æ ¼èƒŒæ™¯
- âœ… **æ ‡å°ºç³»ç»Ÿ** - è¾…åŠ©å®šä½çš„æ ‡å°º
- âœ… **å³é”®æ‹–æ‹½** - å³é”®æˆ– Ctrl+å·¦é”®æ‹–æ‹½ç”»å¸ƒ
- âœ… **æ»šè½®ç¼©æ”¾** - é¼ æ ‡æ»šè½®ç¼©æ”¾ç”»å¸ƒ
- âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
- âœ… **å“åº”å¼å¸ƒå±€** - è‡ªé€‚åº”å®¹å™¨å¤§å°

### ä½¿ç”¨ç¤ºä¾‹

```typescript
import { createRender } from "./Render";

// åˆ›å»ºæ¸²æŸ“å®ä¾‹
const render = createRender(container, {
  width: 800,
  height: 600,
  showBg: true, // æ˜¾ç¤ºèƒŒæ™¯ç½‘æ ¼
  showRuler: true, // æ˜¾ç¤ºæ ‡å°º
  readonly: false, // éåªè¯»æ¨¡å¼
});

// è°ƒæ•´å°ºå¯¸
render.resize(1000, 800);

// é‡ç»˜
render.redraw();

// é”€æ¯
render.destroy();
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### è®¾è®¡æ¨¡å¼

- **ç±»ç»§æ‰¿æ¨¡å¼** - ä½¿ç”¨åŸºç±»ï¼ˆBaseDrawã€BaseHandlerã€BaseToolï¼‰ç»Ÿä¸€æ¥å£
- **æ¨¡å—åŒ–è®¾è®¡** - æ ¸å¿ƒåŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼ˆcore/handlers/tools/drawsï¼‰
- **è§‚å¯Ÿè€…æ¨¡å¼** - äº‹ä»¶ç›‘å¬å’Œå¤„ç†
- **ç­–ç•¥æ¨¡å¼** - ä¸åŒçš„ç»˜åˆ¶å’Œäº¤äº’ç­–ç•¥
- **å°è£…åŸåˆ™** - éšè—å†…éƒ¨å®ç°ï¼Œæš´éœ²å…¬å…± API

### ç±»å‹ç³»ç»Ÿ

```typescript
// å…¬å…± API (ç”¨æˆ·ä½¿ç”¨)
RenderInstance
  - config: RenderConfig
  - resize(width, height): void
  - redraw(drawNames?): void
  - destroy(): void
  - getStageState(): StageState
  - toStageValue(boardPos): number
  - toBoardValue(stagePos): number
  - changeDraggable(draggable): void

// å†…éƒ¨å®ç° (ä¸æš´éœ²ç»™ç”¨æˆ·)
InternalRenderInstance extends RenderInstance
  - stage: Konva.Stage
  - layers: RenderLayers
  - rulerSize: number
  - drawGroups: Map<string, Konva.Group>
```

## ğŸ”§ é…ç½®é€‰é¡¹

### RenderConfig

| å±æ€§        | ç±»å‹      | é»˜è®¤å€¼  | è¯´æ˜             |
| ----------- | --------- | ------- | ---------------- |
| `width`     | `number`  | -       | ç”»å¸ƒå®½åº¦ï¼ˆå¿…å¡«ï¼‰ |
| `height`    | `number`  | -       | ç”»å¸ƒé«˜åº¦ï¼ˆå¿…å¡«ï¼‰ |
| `showBg`    | `boolean` | `false` | æ˜¯å¦æ˜¾ç¤ºèƒŒæ™¯ç½‘æ ¼ |
| `showRuler` | `boolean` | `false` | æ˜¯å¦æ˜¾ç¤ºæ ‡å°º     |
| `readonly`  | `boolean` | `false` | æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼   |

> **æ³¨æ„**ï¼šç¼©æ”¾åŠŸèƒ½å§‹ç»ˆå¼€å¯ï¼Œé»˜è®¤é…ç½®ä¸ºï¼šç¼©æ”¾é€Ÿåº¦ 0.1ï¼Œæœ€å°ç¼©æ”¾ 0.2ï¼Œæœ€å¤§ç¼©æ”¾ 5ã€‚

## ğŸ¨ äº¤äº’æ“ä½œ

- **å³é”®æ‹–æ‹½** - æŒ‰ä½å³é”®æˆ– Ctrl+å·¦é”®æ‹–åŠ¨ç”»å¸ƒ
- **æ»šè½®ç¼©æ”¾** - æ»šåŠ¨é¼ æ ‡æ»šè½®ç¼©æ”¾ç”»å¸ƒ
- **Ctrl+æ»šè½®** - ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾

## ğŸ“ å¼€å‘è§„èŒƒ

- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- éµå¾ªå‡½æ•°å¼ç¼–ç¨‹é£æ ¼
- å®Œå–„çš„ç±»å‹å®šä¹‰å’Œæ³¨é‡Š
- æ¨¡å—åŒ–å’ŒèŒè´£åˆ†ç¦»
- ç»Ÿä¸€çš„ä»£ç é£æ ¼ï¼ˆä½¿ç”¨ ESLint å’Œ Prettierï¼‰

## ğŸ“„ è®¸å¯è¯

MIT

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
